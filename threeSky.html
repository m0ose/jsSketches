<html>
    <script src="https://cdn.jsdelivr.net/gh/lizard-isana/orb.js@2.3/build/orb.v2.js"></script>

<body>
<script type=module>
    import * as THREE from 'https://cdnjs.cloudflare.com/ajax/libs/three.js/r99/three.module.js'
    console.log(THREE)

    setTimeout(main, 1);
    async function main(){
        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera( 140, window.innerWidth / window.innerHeight, 0.1, 10000 );

        var renderer = new THREE.WebGLRenderer();
        renderer.setSize( window.innerWidth, window.innerHeight );
        document.body.appendChild( renderer.domElement );
        const stars = await loadStars()
        console.log('stars', stars)
        await addStars(scene, stars)

        const geometry = new THREE.BoxGeometry();
        const material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
        const cube = new THREE.Mesh( geometry, material );
        cube.position.z = -25
        scene.add(cube)
        console.log('fluffy')
        renderer.render( scene, camera );
    }

    async function addStars( scene, stars, lon=-106, lat=35, date=new Date()){
        var your_location = {
            "latitude":lat,
            "longitude":lon,
            "altitude":0
        }

        for(let i=0; i<stars.declination.length; i++){
            const ra = stars.rightAscension[i]
            const dec = stars.declination[i]
            var star = {
                "ra":ra,
                "dec":dec,
                "distance":54330
            }
            var observe_star = new Orb.Observation({
                "observer":your_location ,
                "target":star
            });
            var horizontal = observe_star.azel(date); 
            const azimuth = horizontal.azimuth //* (Math.PI/180)
            const elev = horizontal.elevation //* (Math.PI/180)
            const geometry = new THREE.BoxGeometry();
            const material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
            const cube = new THREE.Mesh( geometry, material );
            const celR = 900
            const y = Math.sin(elev) * celR 
            const x = -Math.sin(azimuth) * Math.cos(elev) * celR 
            const z = Math.cos(azimuth) * Math.cos(elev) *  celR
            scene.add( cube );

            cube.position.x = x
            cube.position.y = y
            cube.position.z = z

            console.log({ra,dec,x,y,z})
        }

    }

    async function loadStars() {
        const resp = await fetch('./starData.json')
        const json = await resp.json()
        //console.log(json)
        return json
    }
</script>

</body>

</html>